/*!
 * Quara: Query as Sara.
 * @licence ISC
 * @author Bernardo A. Siverio (wandeber) <berthewanderer@gmail.com>
 */
"use strict";var nt=Object.defineProperty;var ut=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var ht=Object.prototype.hasOwnProperty;var mt=(n,t)=>{for(var r in t)nt(n,r,{get:t[r],enumerable:!0})},ft=(n,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ct(t))!ht.call(n,a)&&a!==r&&nt(n,a,{get:()=>t[a],enumerable:!(i=ut(t,a))||i.enumerable});return n};var dt=n=>ft(nt({},"__esModule",{value:!0}),n);var wt={};mt(wt,{Interpreter:()=>P,Lexer:()=>W,Parser:()=>R,Quara:()=>st,default:()=>st});module.exports=dt(wt);var u=class{constructor(t){this.interpreter=t}visit(t){return{value:t.value,output:String(t.value)}}};var M=class extends u{};var q=class extends u{};var L=class extends u{};var e=class{static{this.Backtip="Backtip"}static{this.Id="Id"}static{this.Space="Space"}static{this.Dot="Dot"}static{this.ModVar="TypeVar"}static{this.ModConst="TypeConst"}static{this.TypeAny="TypeAny"}static{this.TypeBoolean="TypeBoolean"}static{this.TypeChar="TypeChar"}static{this.TypeInteger="TypeInteger"}static{this.TypeFloat="TypeFloat"}static{this.TypeDouble="TypeDouble"}static{this.TypeString="TypeString"}static{this.BooleanConstant="BooleanConstant"}static{this.CharConstant="CharConstant"}static{this.IntegerConstant="IntegerConstant"}static{this.DecimalConstant="DecimalConstant"}static{this.StringConstant="StringConstant"}static{this.TextBlock="TextBlock"}static{this.OpPlus="OpPlus"}static{this.OpMinus="OpMinus"}static{this.OpMultiplication="OpMultiplication"}static{this.OpDivision="OpDivision"}static{this.OpModulus="OpModulus"}static{this.OpPow="OpPow"}static{this.OpSqrt="OpSqrt"}static{this.OpIncrement="OpIncrement"}static{this.OpDecrement="OpDecrement"}static{this.OpNot="Not"}static{this.OpEqual="OpEqual"}static{this.OpLaxEqual="OpLaxEqual"}static{this.OpNotEqual="OpNotEqual"}static{this.OpLaxNotEqual="OpLaxNotEqual"}static{this.OpLowerThan="OpLowerThan"}static{this.OpGreaterThan="OpGreaterThan"}static{this.OpLowerThanEqual="OpLowerThanEqual"}static{this.OpGreaterThanEqual="OpGreaterThanEqual"}static{this.OpAnd="OpAnd"}static{this.OpOr="OpOr"}static{this.OpAssign="OpAssign"}static{this.OpPlusAssign="OpPlusAssign"}static{this.OpMinusAssign="OpMinusAssign"}static{this.OpMultiplicationAssign="OpMultiplicationAssign"}static{this.OpDivisionAssign="OpDivisionAssign"}static{this.OpModulusAssign="OpModulusAssign"}static{this.OpPowAssign="OpPowAssign"}static{this.OpDot="OpDot"}static{this.OpArrayAccessorOpen="OpArrayAccessorOpen"}static{this.OpArrayAccessorClose="OpArrayAccessorClose"}static{this.OpSemicolon="OpSemicolon"}static{this.OpColon="OpColon"}static{this.OpQuote="OpQuote"}static{this.OpComma="OpComma"}static{this.OpArrow="OpArrow"}static{this.OpParenthesisOpen="OpParenthesisOpen"}static{this.OpParenthesisClose="OpParenthesisClose"}static{this.OpCurlyBraceOpen="OpCurlyBraceOpen"}static{this.OpCurlyBraceClose="OpCurlyBraceClose"}static{this.If="If"}static{this.Else="Else"}static{this.EndIf="EndIf"}static{this.While="While"}static{this.EndWhile="EndWhile"}static{this.EoF="EoF"}static{this.For="For"}static{this.EndFor="EndFor"}static{this.Each="Each"}static{this.In="In"}static{this.EndEach="EndEach"}static{this.Function="Function"}static{this.Return="Return"}static{this.EndFunction="EndFunction"}static{this.Class="Class"}static{this.EndClass="EndClass"}static{this.Static="Static"}static{this.Abstract="Abstract"}static{this.Final="Final"}static{this.Virtual="Virtual"}static{this.Private="Private"}static{this.Public="Public"}static{this.Protected="Protected"}static{this.Get="Get"}static{this.Set="Set"}static{this.Extends="Extends"}static{this.Interface="Interface"}static{this.EndInterface="EndInterface"}static{this.Implements="Implements"}};var F=class extends u{visit(t){let r,i,a=this.interpreter.visit(t.expr);if(a&&(i=a.value),t.operator.type==e.OpPlus)r=i;else if(t.operator.type==e.OpMinus)r=-i;else if(t.operator.type==e.OpNot)r=!i;else if(t.operator.type==e.OpSqrt)r=Math.sqrt(i);else if(t.operator.type==e.OpIncrement){let p=t.expr.name;r=i+1,this.interpreter.globalScope[p]=r}else if(t.operator.type==e.OpDecrement){let p=t.expr.name;r=i-1,this.interpreter.globalScope[p]=r}return{value:r,output:String(r)}}};var $=class extends u{visit(t){let r,i,a=this.interpreter.visit(t.left),p=this.interpreter.visit(t.right),l=a.value;switch(typeof p<"u"&&(i=p.value),t.operator.type){case e.OpPlus:r=l+i;break;case e.OpMinus:r=l-i;break;case e.OpMultiplication:r=l*i;break;case e.OpDivision:r=l/i;break;case e.OpModulus:r=l%i;break;case e.OpPow:r=l**i;break;case e.OpEqual:r=l===i;break;case e.OpLaxEqual:r=l==i;break;case e.OpNotEqual:r=l!==i;break;case e.OpLaxNotEqual:r=l!=i;break;case e.OpLowerThan:r=l<i;break;case e.OpGreaterThan:r=l>i;break;case e.OpLowerThanEqual:r=l<=i;break;case e.OpGreaterThanEqual:r=l>=i;break;case e.OpAnd:r=l&&i;break;case e.OpOr:r=l||i;break;case e.OpDot:let{name:m}=t.right;typeof l<"u"&&typeof m<"u"&&l.hasOwnProperty(m)&&typeof l[m]!="function"&&(r=l[m]);break;case e.OpCurlyBraceOpen:typeof l<"u"&&l.hasOwnProperty(i)&&typeof l[i]!="function"&&(r=l[i]);break;case e.OpArrayAccessorOpen:typeof l<"u"&&l.hasOwnProperty(i)&&typeof l[i]!="function"&&(r=l[i]);break}return{value:r,output:r}}};var G=class extends u{visit(t){let r,i=t.right.map(p=>this.interpreter.visit(p).value),a=this.interpreter.visit(t.left).value;return r=a(...i),console.log("result",r),{value:r,output:String(r)}}};var j=class extends u{visit(t){let{name:r}=t.left;typeof this.interpreter.globalScope[r]>"u"&&this.interpreter.error("La variable "+r+" no ha sido declarada.");let i=this.interpreter.visit(t.left),a=this.interpreter.visit(t.right),p=i.value,l,m;switch(typeof a<"u"&&(l=a.value),t.operator.type){case e.OpAssign:m=l;break;case e.OpPlusAssign:m=p+l;break;case e.OpMinusAssign:m=p-l;break;case e.OpMultiplicationAssign:m=p*l;break;case e.OpDivisionAssign:m=p/l;break;case e.OpModulusAssign:m=p%l;break;case e.OpPowAssign:m=p**l;break}return this.interpreter.globalScope[r]=m,{value:this.interpreter.globalScope[r]}}};var K=class extends u{visit(t){if(this.interpreter.globalScope.hasOwnProperty(t.name))return{value:this.interpreter.globalScope[t.name],output:this.interpreter.globalScope[t.name]}}};var U=class extends u{visit(t){return{value:t.value}}};var z=class extends u{visit(t){let r;for(let i of t.children){if(r=i.left?.name,r||({name:r}=i),typeof this.interpreter.globalScope[r]<"u")throw new Error(`Variable ${r} already declared.`);this.interpreter.globalScope[r]=null,this.interpreter.visit(i)}return{value:this.interpreter.globalScope[r]}}};var Q=class extends u{visit(t){let r;for(let i of t.children){if(r=i.left.name,typeof this.interpreter.globalScope[r]<"u")throw new Error(`Constant ${r} already declared.`);this.interpreter.globalScope[r]=null,this.interpreter.visit(i)}return{value:this.interpreter.globalScope[r],output:this.interpreter.globalScope[r]}}};var _=class extends u{visit(t){let r=[],i="";for(let a of t.children){let p=this.interpreter.visit(a);r.push(p),p.output&&(i+=p.output)}return r.length>0?r=r[r.length-1].value:r=void 0,{value:r,output:i}}};var H=class{constructor(){this.globalScope={};this.visitors=new Map}registerVisitor(t,r){typeof t!="string"&&(r=t,t=r.constructor.name),this.visitors.set(t,r)}error(t,r){throw t&&console.log(t,r),new Error("Error during execution.")}debug(t=""){console.log("-- Interpreter: "+t)}};var J=class extends u{};var X=class extends u{visit(t){let r;return this.interpreter.visit(t.condition)?.value?r=this.interpreter.visit(t.ifTrue):t.ifFalse&&(r=this.interpreter.visit(t.ifFalse)),{value:r?.value,output:r?.output?String(r.output):void 0}}};var Y=class extends u{visit(t){let r,i,a="";for(;this.interpreter.visit(t.condition).value;)t.body&&(r=this.interpreter.visit(t.body),r&&(i=r.value),r.output&&(a+=r.output));return{value:i,output:a}}};var h=class{accept(t){return t.visit(this)}toString(){return this.constructor.name}};var f=class extends h{constructor(r,i,a){super();this.left=r;this.operator=i;this.right=a;this.token=i}toString(){return this.left+" "+this.operator.value+" "+this.right}};var A=class extends f{};var d=class extends h{constructor(r){super();this.token=r;this.value=r.value}toString(){return String(this.value)}};var g=class extends d{};var Z=class extends d{};var T=class extends h{constructor(){super(...arguments);this.children=[]}};var y=class extends T{constructor(r=null){super();this.typeNode=r}toString(){return"var "+this.typeNode?.value+" "+this.children?.join(" ")}};var w=class extends y{};var x=class extends h{constructor(r,i){super();this.left=r;this.right=i}toString(){return this.left+"("+this.right.join(", ")+")"}};var k=class extends h{constructor(r,i,a,p){super();this.token=r;this.condition=i;this.ifTrue=a;this.ifFalse=p}};var b=class extends d{};var I=class extends d{};var C=class extends d{};var S=class extends h{constructor(r,i){super();this.operator=r;this.expr=i;this.token=r}toString(){return this.operator.value+""+this.expr}};var v=class extends h{constructor(r){super();this.token=r;this.name=r.value}toString(){return String(this.name)}};var V=class extends h{constructor(r,i,a){super();this.token=r;this.condition=i;this.body=a}};var E=class extends d{};var B=class extends T{constructor(r){super();this.token=r}};var tt=class extends u{};var et=class extends u{visit(t){let r="";for(let i of t.children){let a=this.interpreter.visit(i);a.output&&(r+=a.output)}return{value:r,output:r}}};var N=class extends T{};var rt=class extends u{visit(t){let r=[],i="";for(let a of t.children){let p=this.interpreter.visit(a);r.push(p.value),p.output&&(i+=p.output)}return{value:r,output:i}}};var Tt={fixed(n,...t){return n.toFixed(...t)},upperCase(n){return n.toUpperCase()},lowerCase(n){return n.toLowerCase()},contains(n,...t){return n.includes(...t)},isNaN(n){return Number.isNaN(n)},print(n){console.log(n)}},P=class extends H{constructor(r,i={},a=!1){super();this.space="";this.parser=r,this.showDebug=a,this.showDebug?(this.debug("Debug is enabled."),this.visit=this.visitWithDebug):this.visit=this.visitWithoutDebug,this.setVariables(Tt),i&&this.setVariables(i),this.setVariables({obj:{prop1:"prop1 value"}}),this.registerVisitor(A.name,new j(this)),this.registerVisitor(f.name,new $(this)),this.registerVisitor(g.name,new M(this)),this.registerVisitor(Z.name,new J(this)),this.registerVisitor(T.name,new _(this)),this.registerVisitor(w.name,new Q(this)),this.registerVisitor(x.name,new G(this)),this.registerVisitor(b.name,new q(this)),this.registerVisitor(I.name,new L(this)),this.registerVisitor(C.name,new U(this)),this.registerVisitor(S.name,new F(this)),this.registerVisitor(y.name,new z(this)),this.registerVisitor(v.name,new K(this)),this.registerVisitor(k.name,new X(this)),this.registerVisitor(V.name,new Y(this)),this.registerVisitor(B.name,new et(this)),this.registerVisitor(E.name,new tt(this)),this.registerVisitor(N.name,new rt(this))}setVariables(r){Object.assign(this.globalScope,r)}visitWithoutDebug(r){let i=r.constructor.name;if(!this.visitors.has(i))throw new Error(`Visitor ${i} not found.`);return this.visitors.get(i).visit(r)}visitWithDebug(r){let i=this.space;this.showDebug&&(this.space+="  ",console.log(this.space+" "+r.constructor.name,r.toString()));let a=this.visitWithoutDebug(r);return this.showDebug&&(this.space=i),a}interpret(){let r=this.parser.parse();return this.visit(r).value}};var s=class{constructor(t,r){this.type=t;this.value=r;this.type=t,this.value=r}static{this.Types=e}toString(){return`Token(${this.type}, ${this.value})`}};var o=new Map;o.set("!",new s(e.OpNot,"!"));o.set("$not",new s(e.OpNot,"!"));o.set("||",new s(e.OpOr,"||"));o.set("$or",new s(e.OpOr,"||"));o.set("&&",new s(e.OpAnd,"&&"));o.set("$and",new s(e.OpAnd,"&&"));o.set("==",new s(e.OpEqual,"=="));o.set("$eq",new s(e.OpEqual,"=="));o.set("!=",new s(e.OpNotEqual,"!="));o.set("$ne",new s(e.OpNotEqual,"!="));o.set("~=",new s(e.OpLaxEqual,"~="));o.set("$leq",new s(e.OpLaxEqual,"~="));o.set("!~=",new s(e.OpLaxNotEqual,"!~="));o.set("$lne",new s(e.OpLaxNotEqual,"!~="));o.set("<",new s(e.OpLowerThan,"<"));o.set("$lt",new s(e.OpLowerThan,"<"));o.set(">",new s(e.OpGreaterThan,">"));o.set("$gt",new s(e.OpGreaterThan,">"));o.set("<=",new s(e.OpLowerThanEqual,"<="));o.set("$lte",new s(e.OpLowerThanEqual,"<="));o.set(">=",new s(e.OpGreaterThanEqual,">="));o.set("$gte",new s(e.OpGreaterThanEqual,">="));o.set("+",new s(e.OpPlus,"+"));o.set("-",new s(e.OpMinus,"-"));o.set("*",new s(e.OpMultiplication,"*"));o.set("/",new s(e.OpDivision,"/"));o.set("%",new s(e.OpModulus,"%"));o.set("^",new s(e.OpPow,"^"));o.set("**",new s(e.OpPow,"^"));o.set("\xAC/",new s(e.OpSqrt,"\xAC/"));o.set("++",new s(e.OpIncrement,"++"));o.set("--",new s(e.OpDecrement,"--"));o.set("=",new s(e.OpAssign,"="));o.set("+=",new s(e.OpPlusAssign,"+="));o.set("-=",new s(e.OpMinusAssign,"-="));o.set("*=",new s(e.OpMultiplicationAssign,"*="));o.set("/=",new s(e.OpDivisionAssign,"/="));o.set("%=",new s(e.OpModulusAssign,"%="));o.set("^=",new s(e.OpPowAssign,"^="));o.set("(",new s(e.OpParenthesisOpen,"("));o.set(")",new s(e.OpParenthesisClose,")"));o.set(".",new s(e.OpDot,"."));o.set("[",new s(e.OpArrayAccessorOpen,"["));o.set("]",new s(e.OpArrayAccessorClose,"]"));o.set("{",new s(e.OpCurlyBraceOpen,"{"));o.set("}",new s(e.OpCurlyBraceClose,"}"));o.set(";",new s(e.OpSemicolon,";"));o.set(":",new s(e.OpColon,":"));o.set(",",new s(e.OpComma,","));o.set("->",new s(e.OpArrow,"->"));o.set("`",new s(e.Backtip,"`"));o.set('"',new s(e.OpQuote,'"'));o.set("/if",new s(e.EndIf,"/if"));o.set("/while",new s(e.EndWhile,"/while"));o.set("/for",new s(e.EndFor,"/for"));o.set("/each",new s(e.EndEach,"/each"));o.set("/class",new s(e.EndClass,"/class"));o.set("/interface",new s(e.EndInterface,"/interface"));var c=new Map;c.set("true",new s(e.BooleanConstant,!0));c.set("false",new s(e.BooleanConstant,!1));c.set("const",new s(e.ModConst,"const"));c.set("var",new s(e.ModVar,"var"));c.set("any",new s(e.TypeAny,"any"));c.set("char",new s(e.TypeChar,"char"));c.set("int",new s(e.TypeInteger,"int"));c.set("integer",new s(e.TypeInteger,"int"));c.set("float",new s(e.TypeFloat,"float"));c.set("double",new s(e.TypeDouble,"double"));c.set("string",new s(e.TypeString,"string"));c.set("bool",new s(e.TypeBoolean,"bool"));c.set("boolean",new s(e.TypeBoolean,"boolean"));c.set("if",new s(e.If,"if"));c.set("else",new s(e.Else,"else"));c.set("while",new s(e.While,"while"));c.set("for",new s(e.For,"for"));c.set("each",new s(e.Each,"each"));c.set("in",new s(e.In,"in"));c.set("function",new s(e.Function,"function"));c.set("return",new s(e.Return,"return"));c.set("class",new s(e.Class,"class"));c.set("get",new s(e.Get,"get"));c.set("set",new s(e.Set,"set"));c.set("static",new s(e.Static,"static"));c.set("virtual",new s(e.Abstract,"abstract"));c.set("final",new s(e.Final,"final"));c.set("virtual",new s(e.Virtual,"virtual"));c.set("private",new s(e.Private,"private"));c.set("public",new s(e.Public,"public"));c.set("protected",new s(e.Protected,"protected"));c.set("extends",new s(e.Extends,"extends"));c.set("interface",new s(e.Interface,"interface"));c.set("implements",new s(e.Implements,"implements"));var yt=/^[a-záéíóúñç]+$/iu,Ot=/^[a-záéíóúñç0-9]+$/iu,O=class{static isInteger(t){if(isNaN(t))return!1;let r=parseFloat(t);return!!Number.isInteger(r)}static isNumber(t){return typeof t=="number"?!isNaN(t):typeof t=="string"&&t.trim()!==""?!isNaN(Number(t)):!1}static isAlpha(t){return!!t.match(yt)}static isAlphanumeric(t){return!!t.match(Ot)}};var At=/^[a-z_$áéíóúñç]$/iu,St=/^[a-z0-9_$áéíóúñç]$/iu,D=class{static isValidStartVariableName(t){return t.match(At)}static isValidVariableName(t){return t.match(St)}};var ot=class extends Error{constructor(r,i,a,p){super('Ivalid charachter "'+r+'" found in line '+i+" at position "+a+". Near of: "+p);this.character=r;this.line=i;this.position=a;this.nearCode=p}},W=class{constructor(t){this.text=t;this.pos=0;this.line=0;this.lineStartPos=0;this.currentToken=null;this.currentChar=null;this.inTextBlock=!1;this.inTextSection=!1;this.showDebug=!1;t&&this.setText(t)}setText(t){this.text=t,this.pos=0,this.currentToken=null,this.currentChar=null,this.getCurrentChar()}error(t="",r=null){throw t&&console.log(t,r),new ot(String(this.currentChar),this.line+1,this.getLinePosition()+1,this.text.slice(this.pos-10<0?0:this.pos-10,this.pos+10>this.text.length?this.text.length:this.pos+10))}debug(t=""){this.showDebug&&(console.log("-- Lexer: "+t),console.log("  pos:           ",this.pos),console.log("  current char:  ",this.currentChar))}getLinePosition(){return this.pos-this.lineStartPos}getCurrentChar(){this.pos<this.text.length?this.currentChar=this.text[this.pos]:this.currentChar=null}peek(t=1){let r=this.pos+t;return r<this.text.length?this.text[r]:null}advance(t=1){this.pos+=t,this.getCurrentChar()}goToPosition(t){this.pos=t,this.getCurrentChar()}skipSpaces(){for(;[" ",`
`,"\r","	"].includes(this.currentChar);)this.advance()}skipLineComment(){for(this.advance(2);this.currentChar!==null&&this.currentChar!=`
`;)this.advance()}skipBlockComment(){for(this.advance(2);this.currentChar!==null&&(this.currentChar!="*"||this.peek()!="/");)this.advance();this.advance(2)}getString(){let t="";for(this.advance();this.currentChar!='"';)t+=this.currentChar,this.advance();return this.advance(),t}getNumber(){let t=this.pos,r="";for(;this.currentChar=="."||O.isInteger(this.currentChar);)r+=String(this.currentChar),this.advance();return O.isNumber(r)||(r=null,this.goToPosition(t)),r}getCoincidence(t){let r="",i=(a,p)=>{let l=[];for(let m of t)m.length>a&&p==m[a]&&l.push(m);return l.length>0?(t=l,!0):!1};for(;i(r.length,this.currentChar);)r+=String(this.currentChar),this.advance();return r}id(){let t="";for(;this.currentChar!==null&&D.isValidVariableName(this.currentChar);)t+=this.currentChar,this.advance();return c.get(t)?c.get(t):new s(e.Id,t)}getOperator(){let t=Array.from(o.keys()),r=this.getCoincidence(t);return o.get(r)?o.get(r):null}getNextToken(t=!0){let r=null;if(this.currentChar===null)return new s(e.EoF,null);if(this.inTextBlock){if(this.currentChar=="`")return this.inTextBlock=!1,this.getOperator();if(this.currentChar=="}"&&(this.inTextSection=!0,this.advance()),this.inTextSection){let a="";for(;this.currentChar!==null&&this.currentChar!="{"&&this.currentChar!="`";)a+=this.currentChar,this.advance();return this.currentChar=="{"&&(this.inTextSection=!1,this.advance()),new s(e.TextBlock,a)}}else if(this.currentChar=="`")return this.inTextBlock=!0,this.inTextSection=!0,this.getOperator();if([" ",`
`,"\r","	"].includes(this.currentChar))return(this.currentChar===`
`||this.currentChar==="\r"&&this.peek()!==`
`)&&(this.line++,this.lineStartPos=this.pos),t?(this.skipSpaces(),this.getNextToken(t)):(r=new s(e.Space," "),this.advance(),r);if(this.currentChar=="/"&&this.peek()=="*")return this.skipBlockComment(),this.getNextToken(t);if(this.currentChar=="/"&&this.peek()=="/")return this.skipLineComment(),this.getNextToken(t);if(this.currentChar=='"'){let a=this.getString();if(typeof a<"u")return new s(e.StringConstant,a)}if(this.currentChar=="."||O.isInteger(this.currentChar)){let a=this.getNumber();if(a)return O.isInteger(a)?new s(e.IntegerConstant,parseInt(a)):new s(e.DecimalConstant,parseFloat(a))}let i=this.getOperator();if(i)return i;if(D.isValidStartVariableName(this.currentChar))return this.id();this.error("Invalid character.")}};var at=class extends Error{constructor(r,i,a,p){super('Ivalid syntax in "'+r+'" at position '+a+" of line "+i+". Near of: "+p);this.token=r;this.line=i;this.position=a;this.nearCode=p}},pt=[e.TypeBoolean,e.TypeChar,e.TypeInteger,e.TypeFloat,e.TypeDouble,e.TypeString],it=[e.TypeAny,...pt],lt=[e.OpAssign,e.OpPlusAssign,e.OpMinusAssign,e.OpMultiplicationAssign,e.OpDivisionAssign,e.OpModulusAssign,e.OpPowAssign],gt=[e.BooleanConstant,e.IntegerConstant,e.DecimalConstant,e.StringConstant,e.Backtip],R=class{constructor(t){this.showDebug=!1;this.lexer=t}error(t,r){throw t&&console.log(t,r),new at(String(this.currentToken.value),this.lexer.line+1,this.lexer.getLinePosition()-String(this.currentToken.value).length+1,this.lexer.text.slice(this.lexer.pos-10<0?0:this.lexer.pos-10,this.lexer.pos+10>this.lexer.text.length?this.lexer.text.length:this.lexer.pos+10))}debug(t=""){this.showDebug&&(this.lexer.debug(t),console.log("-- Parser: "+t),this.currentToken&&console.log("  current token - "+this.currentToken.type+" - "+this.currentToken.value))}eat(t=null,r=!0){if(!t){this.currentToken=this.lexer.getNextToken(r);return}Array.isArray(t)||(t=[t]),t=t,t.includes(this.currentToken.type)?this.currentToken=this.lexer.getNextToken(r):this.error(this.currentToken.type+" not in ",t)}operator(t){let r=this.currentToken;return this.eat(t),r}typeSpec(){let t=new C(this.currentToken);return this.eat(it),t}constant(){let t;return this.currentToken.type==e.BooleanConstant?(t=new g(this.currentToken),this.eat(e.BooleanConstant)):[e.IntegerConstant,e.DecimalConstant].includes(this.currentToken.type)?(t=new b(this.currentToken),this.eat([e.IntegerConstant,e.DecimalConstant])):this.currentToken.type==e.StringConstant?(t=new I(this.currentToken),this.eat(e.StringConstant)):this.currentToken.type==e.Backtip?t=this.textProcessor():this.currentToken.type==e.OpArrayAccessorOpen&&(t=this.array()),t}array(){let t=new N;for(this.eat(e.OpArrayAccessorOpen);![e.OpArrayAccessorClose].includes(this.currentToken.type);)t.children.push(this.expr()),this.currentToken.type==e.OpComma&&this.eat(e.OpComma);return this.eat(e.OpArrayAccessorClose),t}variable(){let t=new v(this.currentToken);return this.eat(e.Id),t}member(){let t=this.variable(),r=[e.OpDot,e.OpArrayAccessorOpen];for(;r.includes(this.currentToken.type);){let i=!1;this.currentToken.type==e.OpArrayAccessorOpen&&(i=!0);let a=this.operator(r),p;i?p=this.expr():this.currentToken.type==e.OpCurlyBraceOpen?(a=this.operator([e.OpCurlyBraceOpen]),p=this.expr(),this.eat(e.OpCurlyBraceClose)):p=this.variable(),t=new f(t,a,p),i&&this.eat(e.OpArrayAccessorClose)}return t}paramList(){let t=[],r=this.expr();if(r!==null)for(t.push(r);this.currentToken.type==e.OpComma;)this.eat(e.OpComma),t.push(this.expr());return t}funcCall(){this.operator([e.OpParenthesisOpen]);let t=this.paramList();return this.operator([e.OpParenthesisClose]),t}factor(){let t,r=[e.OpMinus,e.OpPlus,e.OpNot,e.OpSqrt];if(r.includes(this.currentToken.type))t=new S(this.operator(r),this.factor());else if(this.currentToken.type==e.OpParenthesisOpen)this.operator([e.OpParenthesisOpen]),t=this.expr(),this.operator([e.OpParenthesisClose]);else if([...gt,e.OpArrayAccessorOpen].includes(this.currentToken.type))t=this.constant();else if([e.OpIncrement,e.OpDecrement].includes(this.currentToken.type)){let i=this.operator([e.OpIncrement,e.OpDecrement]);t=this.member(),t=new S(i,t)}else t=this.member(),[e.OpParenthesisOpen].includes(this.currentToken.type)&&(t=new x(t,this.funcCall()));return t}pow(){let t=this.factor();return this.currentToken.type===e.OpPow&&(t=new f(t,this.operator([e.OpPow]),this.pow())),t}term(){let t=this.pow(),r=[e.Id,e.BooleanConstant,e.CharConstant,e.IntegerConstant,e.DecimalConstant,e.Backtip],i=[e.OpMultiplication,e.OpDivision,e.OpModulus],a=[...r,...i];for(;a.includes(this.currentToken.type);){let p;r.includes(this.currentToken.type)?p=o.get("*"):p=this.operator(i),t=new f(t,p,this.pow())}return t}relational(){let t=this.term(),r=[e.OpPlus,e.OpMinus];for(;r.includes(this.currentToken.type);)t=new f(t,this.operator(r),this.term());return t}equality(){let t=this.relational(),r=[e.OpGreaterThan,e.OpGreaterThanEqual,e.OpLowerThan,e.OpLowerThanEqual];for(;r.includes(this.currentToken.type);)t=new f(t,this.operator(r),this.relational());return t}andOperand(){let t=this.equality(),r=[e.OpEqual,e.OpNotEqual,e.OpLaxEqual,e.OpLaxNotEqual];for(;r.includes(this.currentToken.type);)t=new f(t,this.operator(r),this.equality());return t}orOperand(){let t=this.andOperand();for(;e.OpAnd==this.currentToken.type;)t=new f(t,this.operator([e.OpAnd]),this.andOperand());return t}assignOperand(){let t=this.orOperand();return this.currentToken.type==e.OpOr&&(t=new f(t,this.operator([e.OpOr]),this.orOperand())),t}expr(){let t=this.currentToken.type==e.Id,r=this.assignOperand();return t&&(lt.includes(this.currentToken.type)?r=new A(r,this.operator(lt),this.expr()):this.currentToken.type==e.Id&&this.error("Invalid syntax",this.currentToken.value)),r}declAssign(t=!1){let r=this.member();return(this.currentToken.type==e.OpAssign||t)&&(r=new A(r,this.operator(e.OpAssign),this.expr())),r}commaDecl(t=!1){let r=[this.declAssign(t)];for(;this.currentToken.type==e.OpComma;)this.eat(e.OpComma),r.push(this.declAssign(t));return r}varDecl(){let t=new y;return this.currentToken.type==e.ModVar?(this.eat(e.ModVar),it.includes(this.currentToken.type)&&(t.typeNode=this.typeSpec())):t.typeNode=this.typeSpec(),t.children=this.commaDecl(),t}constDecl(){let t=new w;return this.eat(e.ModConst),pt.includes(this.currentToken.type)&&(t.typeNode=this.typeSpec()),t.children=this.commaDecl(!0),t}declaration(){let t=null;return this.currentToken.type==e.ModConst?t=this.constDecl():[e.ModVar,...it].includes(this.currentToken.type)&&(t=this.varDecl()),t}block(){this.eat([e.OpCurlyBraceOpen]);let t=this.statementList([e.OpCurlyBraceClose]);return this.eat([e.OpCurlyBraceClose]),t}colonBlock(t,r){r=r||t,this.eat([e.OpColon]);let i=this.statementList(t);return r.includes(this.currentToken.type)&&this.eat(r),i}elseStatement(){let t;return this.eat([e.Else]),this.currentToken.type===e.If?t=this.ifStatement():t=this.controlBody(()=>this.colonBlock([e.EndIf])),t}controlCondition(){let t;return this.currentToken.type===e.OpParenthesisOpen?(this.eat([e.OpParenthesisOpen]),t=this.expr(),this.eat([e.OpParenthesisClose])):t=this.expr(),t}controlBody(t){let r;return this.currentToken.type===e.OpCurlyBraceOpen?r=this.block():this.currentToken.type==e.OpColon?r=t():(this.currentToken.type==e.OpArrow&&this.eat([e.OpArrow]),r=this.statement()),r}ifStatement(){let t,r,i,a=this.currentToken;return this.eat([e.If]),t=this.controlCondition(),r=this.controlBody(()=>this.colonBlock([e.EndIf,e.Else],[e.EndIf])),this.currentToken.type==e.Else&&(i=this.elseStatement()),new k(a,t,r,i)}whileStatement(){let t=this.currentToken;return this.eat([e.While]),new V(t,this.controlCondition(),this.controlBody(()=>this.colonBlock([e.EndWhile])))}textBlock(){let t=new E(this.currentToken);return this.eat(e.TextBlock),t}textProcessor(){let t=new B(this.currentToken);for(this.eat(e.Backtip);![e.Backtip,e.EoF].includes(this.currentToken.type);)t.children.push(this.statement());return this.currentToken.type==e.Backtip&&this.eat(e.Backtip),t}statement(){let t=null;return this.currentToken.type==e.If?t=this.ifStatement():this.currentToken.type==e.While?t=this.whileStatement():[e.ModConst,e.ModVar,...it].includes(this.currentToken.type)?t=this.declaration():this.currentToken.type==e.OpSemicolon||(this.currentToken.type==e.Backtip?t=this.textProcessor():this.currentToken.type==e.TextBlock?t=this.textBlock():t=this.expr()),this.currentToken.type==e.OpSemicolon&&this.eat(e.OpSemicolon),t}statementList(t){let r=new T;for(;!t.includes(this.currentToken.type);){let i=this.statement();i&&r.children.push(i)}return r}script(){return this.statementList([e.EoF])}getCurrentMethodName(){let i=new Error().stack.split(`
`)[2].match(/at ((\w+)\.)*(\w*) /);return i[i.index-1]}parse(){return this.eat(),this.script()}};var st=class n{constructor(t,r={},i=!1){this.lexer=new W(t),this.parser=new R(this.lexer),this.interpreter=new P(this.parser,r,i)}run(){return this.interpreter.interpret()}static script(t,r={},i=!1){return new n(t,r,i).run()}};0&&(module.exports={Interpreter,Lexer,Parser,Quara});
